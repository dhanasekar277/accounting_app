var m="is-active",o=["is-active","bg-primary","text-white"],d="data-value",u=class{constructor(t,e={}){for(this.selectElement=t,this.selectElement.style.display="none",this.placeholder=this.getPlaceholder(),this.allowNew=!!t.dataset.allowNew,this.showAllSuggestions=!!t.dataset.showAllSuggestions,this.badgeStyle=t.dataset.badgeStyle||"primary",this.allowClear=!!t.dataset.allowClear,this.server=t.dataset.server||!1,this.liveServer=!!t.dataset.liveServer,this.suggestionsThreshold=t.dataset.suggestionsThreshold?parseInt(t.dataset.suggestionsThreshold):1,this.validationRegex=t.dataset.regex||"",this.separator=t.dataset.separator||null,this.max=t.dataset.max?parseInt(t.dataset.max):null,this.keyboardNavigation=!1,this.clearLabel=e.clearLabel||"Clear",this.searchLabel=e.searchLabel||"Type a value",this.parentForm=t.parentElement;this.parentForm&&(this.parentForm=this.parentForm.parentElement,this.parentForm.nodeName!="FORM"););if(this.parentForm.addEventListener("reset",s=>{this.reset()}),this.holderElement=document.createElement("div"),this.containerElement=document.createElement("div"),this.dropElement=document.createElement("ul"),this.searchInput=document.createElement("input"),this.holderElement.appendChild(this.containerElement),this.containerElement.appendChild(this.searchInput),this.holderElement.appendChild(this.dropElement),this.selectElement.parentNode.insertBefore(this.holderElement,this.selectElement.nextSibling),this.configureSearchInput(),this.configureHolderElement(),this.configureDropElement(),this.configureContainerElement(),this.server&&!this.liveServer)this.loadFromServer();else{let s=Array.from(this.selectElement.querySelectorAll("option")).map(l=>({value:l.getAttribute("value"),label:l.innerText}));this.buildSuggestions(s)}}static init(t="select[multiple]",e={}){let s=document.querySelectorAll(t);for(let l=0;l<s.length;l++){let i=s[l],r=new u(i,e)}}loadFromServer(t=!1){this.abortController&&this.abortController.abort(),this.abortController=new AbortController,fetch(this.server+"?query="+encodeURIComponent(this.searchInput.value),{signal:this.abortController.signal}).then(e=>e.json()).then(e=>{let s=e.data||e;this.buildSuggestions(s),this.abortController=null,t&&this.showSuggestions()}).catch(e=>{e.name!=="AbortError"&&console.error(e)})}getPlaceholder(){let t=this.selectElement.querySelector("option");if(!!t){if(!t.value){let e=t.innerText;return t.remove(),e}return this.selectElement.getAttribute("placeholder")?this.selectElement.getAttribute("placeholder"):this.selectElement.getAttribute("data-placeholder")?this.selectElement.getAttribute("data-placeholder"):""}}configureDropElement(){this.dropElement.classList.add("dropdown-menu"),this.dropElement.classList.add("p-0"),this.dropElement.style.maxHeight="280px",this.dropElement.style.overflowY="auto",this.dropElement.addEventListener("mouseenter",t=>{this.keyboardNavigation=!1})}configureHolderElement(){this.holderElement.classList.add("form-control"),this.holderElement.classList.add("dropdown"),this.isDisabled()&&this.holderElement.setAttribute("readonly",""),this.getBootstrapVersion()===4&&(this.holderElement.style.height="auto")}configureContainerElement(){this.containerElement.addEventListener("click",e=>{this.isDisabled()||this.searchInput.focus()});let t=this.selectElement.querySelectorAll("option[selected]");for(let e=0;e<t.length;e++){let s=t[e];!s.value||(s.dataset.init=1,this.addItem(s.innerText,s.value))}}configureSearchInput(){let t=this;this.searchInput.type="text",this.searchInput.autocomplete="off",this.searchInput.style.backgroundColor="transparent",this.searchInput.style.border=0,this.searchInput.style.outline=0,this.searchInput.style.maxWidth="100%",this.searchInput.ariaLabel=this.searchLabel,this.isDisabled()&&this.searchInput.setAttribute("disabled",""),this.adjustWidth(),this.searchInput.addEventListener("input",e=>{this.adjustWidth(),this.searchInput.value.length>=this.suggestionsThreshold?this.liveServer?this.loadFromServer(!0):this.showSuggestions():this.hideSuggestions()}),this.searchInput.addEventListener("focus",e=>{this.searchInput.value.length>=this.suggestionsThreshold&&this.showSuggestions()}),this.searchInput.addEventListener("focusout",e=>{t.hideSuggestions()}),this.searchInput.addEventListener("keydown",e=>{let s=e.keyCode||e.key;if(this.separator&&e.key==this.separator){e.preventDefault(),this.addItem(this.searchInput.value,null)&&this.resetSearchInput();return}switch(s){case 13:case"Enter":let l=this.getActiveSelection();l?l.click():this.allowNew&&!this.isSelected(this.searchInput.value)&&this.searchInput.value&&this.addItem(this.searchInput.value,null)&&this.resetSearchInput(),e.preventDefault();break;case 38:case"ArrowUp":e.preventDefault(),this.keyboardNavigation=!0;let i=this.moveSelectionUp();this.searchInput.value.length==0&&this.dropElement.classList.contains("show")&&!i&&this.hideSuggestions();break;case 40:case"ArrowDown":e.preventDefault(),this.keyboardNavigation=!0,this.moveSelectionDown(),this.searchInput.value.length==0&&!this.dropElement.classList.contains("show")&&this.showSuggestions();break;case 8:case"Backspace":this.searchInput.value.length==0&&(this.removeLastItem(),this.adjustWidth(),this.hideSuggestions());break}})}moveSelectionUp(){let t=this.getActiveSelection();if(t){let e=t.parentNode;do e=e.previousSibling;while(e&&e.style.display=="none");return e?(t.classList.remove(...o),e.querySelector("a").classList.add(...o),e.parentNode.scrollTop=e.offsetTop-e.parentNode.offsetTop,e):null}return null}moveSelectionDown(){let t=this.getActiveSelection(),e=null;if(t){e=t.parentNode;do e=e.nextSibling;while(e&&e.style.display=="none");return e?(t.classList.remove(...o),e.querySelector("a").classList.add(...o),e.offsetTop>e.parentNode.offsetHeight-e.offsetHeight&&(e.parentNode.scrollTop+=e.offsetHeight),e):null}return e}adjustWidth(){this.searchInput.value?this.searchInput.size=this.searchInput.value.length+1:this.getSelectedValues().length?(this.searchInput.placeholder="",this.searchInput.size=1):(this.searchInput.size=this.placeholder.length,this.searchInput.placeholder=this.placeholder)}buildSuggestions(t=null){for(;this.dropElement.lastChild;)this.dropElement.removeChild(this.dropElement.lastChild);for(let e=0;e<t.length;e++){let s=t[e];if(!s.value)continue;let l=document.createElement("li"),i=document.createElement("a");if(l.append(i),i.classList.add("dropdown-item"),i.setAttribute(d,s.value),i.setAttribute("href","#"),i.innerText=s.label,s.data)for(let[r,n]of Object.entries(s.data))i.dataset[r]=n;this.dropElement.appendChild(l),i.addEventListener("mouseenter",r=>{this.keyboardNavigation||(this.removeActiveSelection(),l.querySelector("a").classList.add(...o))}),i.addEventListener("mousemove",r=>{this.keyboardNavigation=!1}),i.addEventListener("mousedown",r=>{r.preventDefault()}),i.addEventListener("click",r=>{r.preventDefault(),this.addItem(i.innerText,i.getAttribute(d),i.dataset),this.resetSearchInput()})}}reset(){this.removeAll();let t=this.selectElement.querySelectorAll("option[data-init]");for(let e=0;e<t.length;e++){let s=t[e];this.addItem(s.innerText,s.value)}}resetSearchInput(){this.searchInput.value="",this.adjustWidth(),this.hideSuggestions(),this.max&&this.getSelectedValues().length===this.max?this.searchInput.style.visibility="hidden":this.searchInput.style.visibility=="hidden"&&(this.searchInput.style.visibility="visible")}getSelectedValues(){let t=this.selectElement.querySelectorAll("option:checked");return Array.from(t).map(e=>e.value)}showSuggestions(){this.dropElement.classList.contains("show")||this.dropElement.classList.add("show"),this.dropElement.style.left=this.searchInput.offsetLeft+"px";let t=this.searchInput.value.toLocaleLowerCase(),e=this.getSelectedValues(),s=this.dropElement.querySelectorAll("li"),l=!1,i=null,r=!1;for(let n=0;n<s.length;n++){let a=s[n],h=a.innerText.toLocaleLowerCase(),c=a.querySelector("a");if(c.classList.remove(...o),e.indexOf(c.getAttribute(d))!=-1){a.style.display="none";continue}r=!0;let p=t.length===0||h.indexOf(t)!==-1;this.showAllSuggestions||this.suggestionsThreshold===0||p?(a.style.display="list-item",l=!0,!i&&p&&(i=a)):a.style.display="none"}l||this.dropElement.classList.remove("show"),i?(this.holderElement.classList.contains("is-invalid")&&this.holderElement.classList.remove("is-invalid"),i.querySelector("a").classList.add(...o),i.parentNode.scrollTop=i.offsetTop-i.parentNode.offsetTop):!this.allowNew&&!(t.length===0&&!r)?this.holderElement.classList.add("is-invalid"):this.validationRegex&&this.holderElement.classList.contains("is-invalid")&&this.holderElement.classList.remove("is-invalid")}hideSuggestions(){this.dropElement.classList.contains("show")&&this.dropElement.classList.remove("show"),this.holderElement.classList.contains("is-invalid")&&this.holderElement.classList.remove("is-invalid")}getActiveSelection(){return this.dropElement.querySelector("a."+m)}removeActiveSelection(){let t=this.getActiveSelection();t&&t.classList.remove(...o)}removeAll(){this.containerElement.querySelectorAll("span").forEach(e=>{this.removeLastItem()})}removeLastItem(){let t=this.containerElement.querySelectorAll("span");if(!t.length)return;let e=t[t.length-1];this.removeItem(e.getAttribute(d))}getBootstrapVersion(){let t=5;return window.jQuery&&$.fn.tooltip!=null&&$.fn.tooltip.Constructor!=null&&(t=parseInt($.fn.tooltip.Constructor.VERSION.charAt(0))),t}isSelected(t){let e=Array.from(this.selectElement.querySelectorAll("option")).find(s=>s.textContent==t);return!!(e&&e.getAttribute("selected"))}isDisabled(){return this.selectElement.hasAttribute("disabled")||this.selectElement.hasAttribute("readonly")}validateRegex(t){return new RegExp(this.validationRegex.trim()).test(t)}addItem(t,e=null,s={}){if(e||(e=t),this.validationRegex&&!this.validateRegex(t))return this.holderElement.classList.add("is-invalid"),!1;let l=this.getBootstrapVersion(),i=this.selectElement.querySelector('option[value="'+e+'"]');i&&(s=i.dataset);let r=t,n=document.createElement("span"),a=this.badgeStyle;if(n.classList.add("badge"),s.badgeStyle&&(a=s.badgeStyle),s.badgeClass&&n.classList.add(s.badgeClass),l===5?(n.classList.add("bg-"+a),n.classList.add("me-2")):(n.classList.add("badge-"+a),n.classList.add("mr-2")),n.setAttribute(d,e),this.allowClear&&(r=(l===5?'<button type="button" style="font-size:0.65em" class="me-2 btn-close btn-close-white" aria-label="'+this.clearLabel+'"></button>':'<button type="button" style="font-size:1em;float:left;text-shadow:none;color:currentColor;" class="mr-2 close" aria-label="'+this.clearLabel+'"><span aria-hidden="true">&times;</span></button>')+r),n.innerHTML=r,this.containerElement.insertBefore(n,this.searchInput),this.allowClear&&n.querySelector("button").addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),this.removeItem(e),document.activeElement.blur()}),i)i.setAttribute("selected","selected");else{i=document.createElement("option"),i.value=e,i.innerText=t;for(let[h,c]of Object.entries(s))i.dataset[h]=c;i.setAttribute("selected","selected"),this.selectElement.appendChild(i)}return!0}removeItem(t){let e=this.containerElement.querySelector("span["+d+'="'+t+'"]');if(!e)return;e.remove();let s=this.selectElement.querySelector('option[value="'+t+'"]');s&&s.removeAttribute("selected"),this.searchInput.style.visibility=="hidden"&&this.max&&this.getSelectedValues().length<this.max&&(this.searchInput.style.visibility="visible")}},f=u;export{f as default};
//# sourceMappingURL=tags.min.js.map
